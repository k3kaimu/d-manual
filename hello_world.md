---
layout: post
title:  "01 D言語入門-Hello, World!"
date:   2013-5-6 00:00:00
categories: dmanual
tags: dmanual
---

{{ **注意** このページを含むd-manualの全記事は[専用ページ](https://k3kaimu.github.io/dmanual/)へ移行しました。今後は専用ページでご覧ください。}}

{% tree %}

## Hello, world!---その前に

プログラミングの入門といえば`Hello, world!`ですね。
早速書いてみたいのですが、皆さんは **コンパイラ** と **テキストエディタ** は手に入れていますか？

プログラム(==ソースコード)を書くには、テキストエディタがいります。
notepad.exeで編集したければそれでいいのですが、せっかくなのでカッコイイテキストエディタを入手しましょう。
各エディタの説明はしませんが、個人的にはSublime Text2がオススメです。

* Sublime Text2
* notepad++
* Vim
* Emacs

エディタをゲットしたら、次はコンパイラを持ってこないといけません。
D言語のコンパイラは有名なもので **dmd**, **gdc**, **ldc** などがありますが、普通は **dmd** を使うので[ここ](http://dlang.org/download.html)からダウンロードしましょう。
Windowsの人は"dmd Windows installer"をダウンロードして実行すれば全部設定してくれます。

インストールが終われば、コンソール(ターミナル)画面をたちあげて`dmd`と打ちましょう。
ズラズラズラ～と文字が出てきたら成功です。


## Hello, world!

さて、テキストエディタを立ち上げて以下の文字列をそのまま打ち込んで`helloworld.d`で保存しましょう。

````d
import std.stdio;

void main()
{
    writeln("Hello, world!");
}
````

次にコンソールで以下をタイプします。
`$` から始まる1行はコンソールへの入力を表しますが、`$`はわざわざ打たなくて結構です。
なので、`$`以降の`rdmd ~`を打ち込みましょう。

(`rdmd`が見つからないとエラーが出たら`dmd -run`を使ってみてください。)

````
$ rdmd helloworld.d
````

コンソールで以下のように出力されれば成功です、おめでとう！

````
Hello, world!
````


### 注意...

これからは`rdmd ...`などのコマンドと実行結果を一緒に、以下のように表記します。

````
$ rdmd helloworld.d
Hello World!
````

## Hello, world!を詳しくみてみる

先ほど書いたHello Worldプログラムを解析してみましょう。

### 注意...

ここから先はいきなり意味がわからない単語が急増します。
しかし、後から詳しく説明しますので、難しければ素直に読み飛ばしましょう。
そのうち分かるようになるので、「もうだめぽ」とか「やっぱり自分には向いてない」とか思わないように。
執筆者も「これはまだ分からなくていい内容だわ」と割りきって書いています。


### 1行目

````d
import std.stdio;
````

「モジュール`std.stdio`を読み込む」という意味です。
`std.stdio`の`std`はstandardの略で、`stdio`はstandard Input/Outputの略です。
なので`std.stdio`というのは、「`std`パッケージに属する`stdio`モジュール」という意味です。
これについては、モジュールの章で説明します。

なぜこのような記述をしなければいけないかというと、5行目で出てくる`writeln`をプログラム中で使いたいからです。
`writeln`は`std.stdio`で定義されているのですが、自分のプログラムに`import`(輸入)してやらなければ使えません。
つまり、「`bar`モジュールで定義されてる`foo`を使いたい！」という場合には、`import bar;`と書かなければいけません。


### 2行目

2行目はただの空白です。
D言語のプログラムのソースコード中では、 **任意の場所に空白や改行を入れても構いません** 。
もちろん、`import`を`i   m p o r t`と書いてはいけません。


### 3行目

````d
void main()
````

D言語で書かれたプログラムは、 **`main`** という関数(`function`)から始まります。
プログラムでの関数は数学の関数とほとんど同じで、入力(`input`)を受け取り、加工や外界に影響を及ぼしてから出力(`output`)を返すものです。
この`main`の場合は何も受け取らずなにも返しません(`void`)が、`void main(string[] args)`と書けば、`string[] args`を受け取ってなにも返さない`main`関数となります。
関数はソースコード上では以下のように記述されます。

````d
OutputType fName(InputType1 arg1, InputType2 arg2, ...)
{
    function Body
}
````

`OutputType`は関数の出力の型(タイプ)、`InputType1`とか`InputType2`は入力の型(タイプ)で、`arg1, arg2`は仮引数(かりひきすう)と呼ばれます。
また、`InputType1, InputType2`は引数の型, `OutputType`は返り値や戻り値の型(`Returned Type`)と呼ばれます。
`function Body`は関数本体といい、入力から出力を生成する手順を記述します。


### 4行目

````d
{
````

3行目の項で説明した関数の`{}`のうちの開始の括弧です。
ここから6行目の`}`までは関数本体となります。


### 5行目

````d
    writeln("Hello, world!");
````

この行は、「`writeln`という関数に`"Hello, world!"`を引数として渡して、呼び出す」という意味です。
`writeln`という関数は`std.stdio`にあるというのは説明しましたね。

`writeln`は、`"write"`, `"ln"`に分解できます。
`"write"`は書きだす、`"ln"`は改行を意味します。
つまり、`writeln("Hello, world!")`は「`"Hello, world!"`と書きだして改行する」という意味です。

`writeln`があるんだから、`write`もあります。
`write`は改行なしで出力すること以外は`writeln`と同じ動作です。
`write, writeln`について後ほど詳しく説明します。


### 6行目

````d
}
````

`main`関数の終了を表す括弧です。
D言語のソースコードでは、括弧は必ず対になっていなければなりません。


## write, writelnと型について

`write, writeln`は`std.stdio`で宣言(==定義)されています。
`write`や`writeln`は複数の引数を受け取ることができます。
つまり、先ほどのHello, worldのプログラムを改変した以下のコードも有効です。
コンパイルして実行してみましょう。

````d
import std.stdio;

void main()
{
    writeln("Hello, ", "World! ", 123);
}
````

````
$ rdmd helloworld.d
Hello, World! 123
````

さて、`"Hello, "` や `"World! "` は `""` でくくりましたが、`123`は`""`でくくってません。
というのは、`""`でくくったものは <b>`string`(文字列)</b> という型になるのに対し、`123`とそのまま書くと **`int`(整数)** という型になります。

ほとんどのプログラミング言語は、データに **型** を持ちます。
ここでいうデータというのは、`"Hello, "`とか`123`とかのことで、型というのは`string`, `int`のことです。
もしデータに型がなければどうなるでしょうか？
コンピュータは`0, 1`で全てを表しているといいますが、`123`も`"Hello, "`も`0`と`1`で表されてしまいますから、文字なのか数値なのかよくかわらなくなってしまいます。
そのようなことを避けるために、数値には`int`, 文字列には`string`と型を付けるのです。
そして、`writeln`はどんな型が入力に入っているかを確認できるので、それぞれの型に合わせて出力のフォーマットを変えてくれます。


## 関数について

型についてちょっとはわかったと思うので、次は **関数** について少し理解しましょう。
プログラムは関数とデータの集合だと考えることができます。
「関数にデータを渡して、関数がデータを処理してなにか値を返す」というのがプログラムの流れです。
**関数中では、原則上から順番に文が実行されていきます** 。

````d
import std.stdio;

void main()
{
    write("Hello, ");
    write("World! ");
    writeln(123);
}
````

上のコードを実行しても、一つ前のものと同じ表示になります。
もし、関数内の実行手順が上から下でないなら、ぐちゃくちゃになっているはずです。

`main`関数以外の関数を定義して呼び出すことも可能です。
以下のコードでは何もしない関数`foo`を定義して`main`関数から呼び出しています。

````d
void main()
{
    foo();
}


void foo(){}
````

`foo`の位置は重要でなくて、たとえば`main`関数の上に書いても大丈夫です。

````d
void foo(){}

void main()
{
    foo();
}
````

`foo`を2回呼び出すことも可能です。

````d
void foo(){}

void main()
{
    foo();
    foo();
}
````

## writef, writefln

C言語を勉強した人は、一度は`printf`を使ったことがありますね。
D言語にも`printf`のようにフォーマットを指定して数値などを出力できる`writef, writefln`があります。

````d
import std.stdio;

void main()
{
    writefln("%d : %d", 1, 2);
    writefln("%s : %s", 2, 4);
}
````

````
$ rdmd helloworld.d
1 : 2
2 : 4
````

一番最初の`%d`と書いた部分に`1`が入り、次の`%d`には`2`が入っていることが実行結果からわかりますね。
次の行では2つの`%s`にそれぞれ`2`, `4`が入っています。
`%d`や`%s`はフォーマット指定子といい、`%d`は10進数出力を表します。
`%s`はデフォルトの指定子で、この場合は`%d`に等しくなります。

もし数値を16進数で出力したい場合には`%x`, `%X`を使います。
`%x`は小文字、`%X`は大文字で出力します。

````d
import std.stdio;

void main()
{
    writefln("%x : %X", 200, 200);
}
````

````
$ rdmd helloworld.d
c8 : C8
````

もし、文字列を出力したいなら`%s`を使います。

````d
import std.stdio;

void main()
{
    writefln("%s", "これは文字列");
}
````

````
$ rdmd helloworld.d
これは文字列
````

`%d`や`%x`で文字列を出力しようとした場合にはエラーが出ます。

````d
import std.stdio;

void main()
{
    writefln("%d", "これは文字列");
}
````

````
$ rdmd helloworld.d
object.Exception@C:\D\dmd2\src\phobos\std\format.d(2154): Incorrect format specifier for range: %d
----------------
0x00416574
0x004163FF
0x0040466A
0x00404206
0x0040416F
0x004029C1
0x004025F8
0x0040256A
0x00412078
0x0040E329
0x0040B3C0
0x75A833AA in BaseThreadInitThunk
0x77DD9EF2 in RtlInitializeExceptionChain
0x77DD9EC5 in RtlInitializeExceptionChain
````

指定子がわからなかった場合には`%s`としておけば最適なフォーマットで出力されるので便利ですね。


## コメント

たとえば、あなたが高度な技術を使用した複雑なプログラムを書いたとしましょう。
そのプログラムにバグがあることが、1週間後に判明しました。
さて、あなたはプログラムのバグを取り払うことができるでしょうか？

このような状況にされされた場合、ソースコードを読み解く必要があるのですが、コメントを残しておくことでソースコードの可読性が向上します。
たとえば、「ここではhogehogeをfugafugaしている」などです。
よいコメントを書けるプログラマはよいプログラマになれます(たぶん)。

````d
//std.stdioを読み込む
import stds.stdio;

/** main関数
 * Hello, World!と出力
 */
void main()
{
    /+
    writeln("fugafuga");
        /+
        writeln("なんだと…");
        +/
    writeln("hogehoge");
    +/

    writeln("Hello, World!");
}


/* ネストできないコメント
ここはコメント
    /*
    ここはコメント
    */
ここはコメントでない
*/

/+ ネストできるコメント
ここはコメント
    /+
    ここはコメント
    +/
ここはコメント
+/

/** ドキュメント
*/

/++ ネスト可能なドキュメント
+/

// １行コメント
````

## 問題 -> [解答]({{ site.baseurl }}/dmanual/answer#hello_world)

* 次のソースコードの`<a>`と`<b>`の部分に適切なものを入れて、`Hello, World!`と表示するプログラムを作ってください。  

~~~~d
import std.stdio;

void main()
{
    writeln("%s, %s", <a>, <b>);
}
~~~~


* 次のソースコードは複数箇所間違っています。コンパイルしてエラーを確認しながら、訂正してください。

~~~~d
vood main{
    writeln("Hello, World");
}
~~~~


* つぎのソースコードをコンパイルして、エラーメッセージを読んでみましょう。プログラミングではエラーメッセージに慣れることが上達するための近道です。  

~~~~d
void main(){
    writeln("foo");
}
~~~~

~~~~d
void main(){
    writeln("foo");

~~~~

~~~~d
void main{}
~~~~

~~~~d
main()
~~~~

~~~~d
main
~~~~


## おわりに

さて、第一回目の「Hello, World!」の項が終わりました。お疲れ様でした。
実は今回はかなり内容が詰まっていて、書いてる途中から、「初心者にはつらいかなあ」と思っていました。
プログラムの概念を考えると、今のノイマン型コンピュータを考えるところまで行き着いてしまい、D言語の話になかなか戻ってこれないので、このようなちょっと難しい形式になってしまいました。
このような難しいお話については、C言語の入門書の頭のほうにわかりやすく書かれていることが多いので、図書館へ行って借りることをオススメします。
また、D言語について詳しく知りたいと思った方は、「プログラミング言語D」(The D Programming Language; 略称:TDPL)という本をおすすめします。D言語の文法やそれに至った経緯など、詳しく学ぶにはとっておきです。
ただ、プログラミング初心者向けではなく、ある程度プログラムの知識がないと難しい内容の本です。


## キーワード

* `dmd`
* `import`
* `std.stdio`
* `main`
* 関数(`function`)
* `write`, `writeln`, `writef`, `writefln`
* 型(`type`)
* 値(`value`)
* 数値(integer, `int`型)
* 文字列(`string`型)
* フォーマット
* コメント
